#!/bin/sh
set -e

case "$1" in
  configure)
    mkdir -p /etc/apt/apt.conf.d
    printf '%s\n' 'Acquire::Check-Valid-Until "false";' \
      > /etc/apt/apt.conf.d/80snapshot
    if [ -f "/etc/apt/preferences.d/force-testing" ]; then
      rm /etc/apt/preferences.d/force-testing
      apt-get update && apt get full-upgrade -y || true
    else
      apt-get update || true
    fi
    ;;
  triggered)
    install -m 644 /usr/share/kainat-os-sources/sources.list.master \
                   /etc/apt/sources.list
    apt-get update || true
    ;;
  *)
    # dpkg policy: do nothing on abort-* actions
    ;;
esac

exit 0
